{
  "name": "waivers-public",
  "attributes": [
    {
      "name": "scala",
      "value": {
        "version": "3.4",
        "package": "db.generated"
      }
    },
    {
      "name": "psql",
      "value": {
        "pkey": "id",
        "hash_code": {},
        "audit": {
          "created": {
            "at": { "type": "date-time-iso8601" }
          },
          "updated": {
            "at": { "type": "date-time-iso8601" },
            "by": { "name": "updated_by_user_id", "type": "string" }
          }
        }
      }
    }
  ],

  "models": {
    "project": {
      "description": "A waiver project",
      "fields": [
        { "name": "id", "type": "string" },
        {
          "name": "name",
          "type": "string",
          "description": "Name of the project"
        },
        {
          "name": "slug",
          "type": "string",
          "description": "URL-friendly slug for the project"
        },
        {
          "name": "lower_slug",
          "type": "string"
        },
        {
          "name": "status",
          "type": "string",
          "description": "Current status of the project: active, inactive"
        }
      ],
      "attributes": [
        {
          "name": "scala",
          "value": {
            "pkey_generator": {
              "class": "com.mbryzek.util.IdGenerator",
              "prefix": "prj"
            }
          }
        },
        {
          "name": "psql",
          "value": {
            "on_conflict": { "fields": ["lower_slug"] }
          }
        }
      ]
    },
    "waiver": {
      "description": "A waiver version for a project",
      "fields": [
        { "name": "id", "type": "string" },
        {
          "name": "project_id",
          "type": "string",
          "description": "ID of the project this waiver belongs to"
        },
        {
          "name": "version",
          "type": "integer",
          "description": "Version number of this waiver",
          "minimum": 1
        },
        {
          "name": "content",
          "type": "string",
          "description": "Content of the waiver"
        }
      ],
      "attributes": [
        {
          "name": "scala",
          "value": {
            "pkey_generator": {
              "class": "com.mbryzek.util.IdGenerator",
              "prefix": "wvr"
            }
          }
        },
        {
          "name": "psql",
          "value": {
            "on_conflict": { "fields": ["project_id", "version"] },
            "foreign_keys": [
              {
                "fields": ["project_id"],
                "references": "public.projects"
              }
            ]
          }
        }
      ]
    },
    "signature": {
      "description": "A signature record",
      "fields": [
        { "name": "id", "type": "string" },
        { "name": "waiver_id", "type": "string" },
        { "name": "person_first_name", "type": "string" },
        { "name": "person_last_name", "type": "string" },
        { "name": "person_email", "type": "string" },
        { "name": "person_phone", "type": "string", "required": false },
        {
          "name": "status",
          "type": "string",
          "description": "Status of the signature: pending, signed, cancelled, failed"
        },
        {
          "name": "signed_at",
          "type": "date-time-iso8601",
          "required": false,
          "description": "When the signature was completed"
        },
        {
          "name": "pdf_url",
          "type": "string",
          "required": false,
          "description": "URL to the signed PDF"
        }
      ],
      "attributes": [
        {
          "name": "scala",
          "value": {
            "pkey_generator": {
              "class": "com.mbryzek.util.IdGenerator",
              "prefix": "sig"
            }
          }
        },
        {
          "name": "psql",
          "value": {
            "indexes": [{ "fields": ["waiver_id"] }],
            "foreign_keys": [
              {
                "fields": ["waiver_id"],
                "references": "public.waivers"
              }
            ]
          }
        }
      ]
    }
  }
}
