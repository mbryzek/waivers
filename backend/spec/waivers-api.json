{
  "name": "waivers-api",
  "namespace": "io.bryzek.waivers.api.v0",

  "imports": [
    {
      "uri": "https://app.apibuilder.io/bryzek/waivers-error/latest/service.json"
    }
  ],

  "enums": {
    "project_status": {
      "description": "Status of a waiver project",
      "values": [
        {
          "name": "active",
          "description": "Project is accepting new waivers"
        },
        {
          "name": "inactive",
          "description": "Project is not accepting new waivers"
        }
      ]
    },
    "signature_status": {
      "description": "Status of a waiver signature",
      "values": [
        {
          "name": "pending",
          "description": "Signature has been initiated but not completed"
        },
        {
          "name": "signed",
          "description": "Waiver has been successfully signed"
        },
        {
          "name": "expired",
          "description": "Signature request has expired"
        },
        {
          "name": "cancelled",
          "description": "Signature request was cancelled"
        }
      ]
    }
  },

  "models": {
    "project": {
      "description": "A waiver project",
      "fields": [
        { "name": "id", "type": "string", "description": "Unique identifier" },
        {
          "name": "name",
          "type": "string",
          "description": "Display name of the project"
        },
        {
          "name": "slug",
          "type": "string",
          "description": "URL-friendly unique identifier"
        },
        {
          "name": "status",
          "type": "project_status",
          "description": "Current status of the project"
        }
      ]
    },

    "person": {
      "fields": [
        { "name": "email", "type": "string", "description": "Email address" },
        { "name": "first_name", "type": "string", "description": "First name" },
        { "name": "last_name", "type": "string", "description": "Last name" },
        {
          "name": "phone",
          "type": "string",
          "required": false,
          "description": "Optional phone number"
        }
      ]
    },

    "waiver": {
      "description": "A waiver template",
      "fields": [
        { "name": "id", "type": "string", "description": "Unique identifier" },
        { "name": "project_id", "type": "string" },
        {
          "name": "version",
          "type": "integer",
          "description": "Version number"
        },
        {
          "name": "content",
          "type": "string",
          "description": "Full waiver text content"
        }
      ]
    },

    "waiver_reference": {
      "fields": [
        { "name": "id", "type": "string", "description": "Unique identifier" }
      ]
    },

    "signature": {
      "description": "A waiver that is signed or in the process of being signed",
      "fields": [
        { "name": "id", "type": "string", "description": "Unique identifier" },
        { "name": "person", "type": "person" },
        { "name": "waiver", "type": "waiver_reference" },
        { "name": "status", "type": "signature_status" },
        {
          "name": "signed_at",
          "type": "date-time-iso8601",
          "required": false,
          "description": "When the waiver was signed"
        }
      ]
    },

    "signature_form": {
      "fields": [
        {
          "name": "first_name",
          "type": "string",
          "description": "First name of the person"
        },
        {
          "name": "last_name",
          "type": "string",
          "description": "Last name of the person"
        },
        {
          "name": "email",
          "type": "string",
          "description": "Email address of the person"
        },
        {
          "name": "phone",
          "type": "string",
          "required": false,
          "description": "Optional phone number"
        }
      ]
    },

    "signature_completion_form": {
      "fields": [{ "name": "signature", "type": "string" }]
    }
  },

  "resources": {
    "project": {
      "operations": [
        {
          "method": "GET",
          "path": "/projects/:slug",
          "description": "Get project by slug",
          "responses": {
            "200": { "type": "project" },
            "404": { "type": "io.bryzek.waivers.error.v0.models.generic_error" }
          }
        }
      ]
    },

    "waiver": {
      "operations": [
        {
          "method": "GET",
          "path": "/projects/:slug/waiver",
          "description": "Get current waiver for a project",
          "responses": {
            "200": { "type": "waiver" },
            "404": { "type": "io.bryzek.waivers.error.v0.models.generic_error" }
          }
        }
      ]
    },

    "signature": {
      "operations": [
        {
          "method": "POST",
          "path": "/projects/:slug/signatures",
          "body": { "type": "signature_form" },
          "responses": {
            "201": { "type": "signature" },
            "400": {
              "type": "[io.bryzek.waivers.error.v0.models.generic_error]"
            },
            "404": { "type": "io.bryzek.waivers.error.v0.models.generic_error" }
          }
        },
        {
          "method": "GET",
          "path": "/signatures/:id",
          "description": "Get signature status",
          "responses": {
            "200": { "type": "signature" },
            "404": { "type": "io.bryzek.waivers.error.v0.models.generic_error" }
          }
        },
        {
          "method": "POST",
          "path": "/signatures/:id/complete",
          "description": "Complete a signature with signature data",
          "body": { "type": "signature_completion_form" },
          "responses": {
            "200": { "type": "signature" },
            "400": {
              "type": "[io.bryzek.waivers.error.v0.models.generic_error]"
            },
            "404": { "type": "io.bryzek.waivers.error.v0.models.generic_error" }
          }
        }
      ]
    }
  }
}
